<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: fullCalendar/fullCalendar.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: fullCalendar/fullCalendar.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class FullCalendar extends HTMLElement {
    constructor() {
        super();
        this.globalDate = new Date();
        this.tasks = [];
        this.attachShadow({ mode: "open" });
    }

    connectedCallback() {
        const styles = document.createElement("style");
        styles.innerHTML = `
            table {
                border-collapse: collapse;
            }
            
            td, th {
                border: 1px solid #ddd;
                padding: 10px;
            }
            
            .days-header {
                width: 50px;
            }
            
            td {
                width: 50px;
                height: 50px;
                vertical-align: top;
                text-align: left;
                font-size: x-small;
            }
            
            .not-in-month {
                background-color: rgba(231, 231, 231, 0.5);
            }
            
            .task {
                display: block;
                background-color: #f5f5f5;
                margin: 2px 0;
                padding: 2px;
                border-radius: 3px;
                font-size: 10px;
            }
        `;

        this.shadowRoot.appendChild(styles);

        this.createHeader();

        const calendar = document.createElement('table');
        calendar.id = 'calendar-display'
        this.shadowRoot.appendChild(calendar);

        this.loadButtons();
        this.loadMonth(this.globalDate);
        this.loadCalendar(this.globalDate);
        this.fetchTasks(this.globalDate); // Fetch tasks after rendering the calendar
    }

    /**
     * Creates the elements for the header of the calendar
     */
    createHeader() {
        const header = document.createElement('header');
        const currentTime = document.createElement('p');
        currentTime.id = 'curr-mont-year';
        
        const prev = document.createElement('button');
        prev.id = "prev";
        prev.innerText = "prev";

        const next = document.createElement('button');
        next.id = "next";
        next.innerText = "next";

        header.append(currentTime, prev, next);

        this.shadowRoot.appendChild(header);
    }

    /**
     * Gets the current month of the first date in the calendar
     * 
     * @param {Date} currentDate 
     */
    loadMonth(currentDate) {
        const currHeader = this.shadowRoot.getElementById('curr-mont-year');
        
        const currentMonthYear = currentDate.toLocaleString("en-US", {
            month: "long", year: "numeric"
        });
        currHeader.innerText = currentMonthYear;
    }

    /**
     * Loads the previous and next buttons to go through the months
     */
    loadButtons() {
        const previousButton = this.shadowRoot.getElementById('prev');
        const afterButton = this.shadowRoot.getElementById('next');

        previousButton.addEventListener("click", () => {
            this.globalDate = new Date(this.globalDate.getFullYear(), this.globalDate.getMonth() - 1, 1);
            this.loadMonth(this.globalDate);
            this.loadCalendar(this.globalDate);
            this.fetchTasks(this.globalDate);
        });

        afterButton.addEventListener("click", () => {
            this.globalDate = new Date(this.globalDate.getFullYear(), this.globalDate.getMonth() + 1, 1);
            this.loadMonth(this.globalDate);
            this.loadCalendar(this.globalDate);
            this.fetchTasks(this.globalDate);
        });
    }

    /**
     * Fetches tasks from the server for the given date
     * 
     * @param {Date} date 
     */
    fetchTasks(date) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1; // Month is zero-indexed
        fetch(`/tasks-this-month?year=${year}&amp;month=${month}`)
            .then(response => response.json())
            .then(data => {
                this.tasks = Array.isArray(data) ? data : []; // Ensure tasks is always an array
                this.updateCalendarWithTasks();
            })
            .catch(error => {
                console.error('Error fetching tasks:', error);
                this.tasks = []; // Clear tasks on error
                this.updateCalendarWithTasks(); // Update calendar even on error
            });
    }

    /**
     * Loads the entire calendar based on the inputted start date
     * 
     * @param {Date} currentDate 
     */
    loadCalendar(currentDate) {
        const calendar = this.shadowRoot.getElementById("calendar-display");

        calendar.innerHTML = '';

        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        // create days header
        const dayHeader = document.createElement("tr");
        days.forEach(day => {
            const dayTh = document.createElement("th");
            dayTh.className = "days-header";

            dayTh.textContent = day;
            dayHeader.appendChild(dayTh);
        });
        calendar.appendChild(dayHeader);

        const currentYear = currentDate.getFullYear();
        const currentMonth = currentDate.getMonth();

        // the starting day of the month
        const startDay = (new Date(currentYear, currentMonth, 1)).getDay();

        // gets total days in month using the previous day before the next month first day 
        const totalMonthDays = (new Date(currentYear, currentMonth + 1, 0)).getDate(); 

        // how many weeks in current month
        const totalWeeks = Math.ceil((startDay + totalMonthDays) / 7);

        // determines when to start dates
        let previousMonthDates = 0;
        let date = 1;

        // go through each week
        for (let week = 0; week &lt; totalWeeks; week++) {
            const weekRow = document.createElement('tr');
            weekRow.className = "week";

            // go through each day in the week
            for (let day = 0; day &lt; 7; day++) {

                // create the cell for the day
                const dayOfWeek = document.createElement('td');
                
                // if we HAVE started the month
                if (previousMonthDates === startDay &amp;&amp; date &lt;= totalMonthDays) {
                    dayOfWeek.innerHTML = date;
                    dayOfWeek.id = new Date(currentDate.getFullYear(), currentDate.getMonth(), date).toLocaleDateString();

                    date++;
                } else {
                    dayOfWeek.innerHTML = '';
                    dayOfWeek.classList.add('not-in-month');
                    previousMonthDates++;
                }

                weekRow.appendChild(dayOfWeek);
            }

            calendar.appendChild(weekRow);
        }
    }

    /**
     * Updates the calendar with tasks for the current month
     */
    updateCalendarWithTasks() {
        // const calendar = this.shadowRoot.getElementById("calendar-display");
        this.tasks.forEach(task => {
            const taskDate = new Date(task.due_date).toLocaleDateString();
            const dayCell = this.shadowRoot.getElementById(taskDate);
            if (dayCell) {
                const taskElement = document.createElement('span');
                taskElement.className = 'task';
                taskElement.textContent = task.title;
                dayCell.appendChild(taskElement);
            }
        });
    }
}

customElements.define("full-calendar", FullCalendar);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="DisplayTasks.html">DisplayTasks</a></li><li><a href="Server.html">Server</a></li><li><a href="SnippetCreation.html">SnippetCreation</a></li></ul><h3>Classes</h3><ul><li><a href="CompletedStatistics.html">CompletedStatistics</a></li><li><a href="CreatedSnippets.html">CreatedSnippets</a></li><li><a href="SideCalendar.html">SideCalendar</a></li></ul><h3>Global</h3><ul><li><a href="global.html#countStreak">countStreak</a></li><li><a href="global.html#fetchJson">fetchJson</a></li><li><a href="global.html#fetchVisits">fetchVisits</a></li><li><a href="global.html#populateStreak">populateStreak</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Jun 08 2024 06:11:33 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
