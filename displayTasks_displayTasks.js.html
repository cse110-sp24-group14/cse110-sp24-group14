<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: displayTasks/displayTasks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: displayTasks/displayTasks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Fetch data from json file and add to table
 *
 * @param {string} date - date to fetch tasks from
 */
const fetchJson = (date) => {
    fetch(`/tasks?date=${date}`)
        .then((data) => data.json())
        .then((json) => {
            populateTable(json);
        })
        .catch((err) => console.error(err));
};

/**
 * Calls a PUT method to update the completed column in the SQL database
 * 
 * @param {Object} task - task to update
 * @param {boolean} completion - state of completed to update to
 */
const updateCompleted = (id, completion) => {
    // update the task to be completed in SQL database
    fetch(
        `/updated-task-completion?taskId=${id}&amp;completed=${completion}`,
        { method: 'PUT' }
    );
}

/**
 * Calls a DELETE method to delete a task from the SQL database
 * 
 * @param {number} id -- id of the task to be deleted 
 */
const deleteTask = (id) => {
    fetch(
        `/delete-task?taskId=${id}`,
        { method: 'DELETE' }
    );
}

/**
 * Adds all the tasks to their corresponding table
 *
 * @param {JSON} taskList - list of today's fetched tasks
 */
const populateTable = (taskList) => {
    const table = document.getElementById("task-table");
    table.innerHTML = ""

    // go through each task and create a row
    taskList.forEach((task) => {

        const row = document.createElement("tr");
        row.classList.add(task.completed ? "complete" : "incomplete");

        const cell = document.createElement("td");

        cell.innerHTML = task.title;
        cell.setAttribute("data-id", task.id);
        cell.classList.add("task");

        row.appendChild(cell);

        const buttonContainer = document.createElement("div");
        buttonContainer.className = "button-container";

        const [complete_button, delete_button] = addButtons();

        // add completion button if incomplete
        if (!task.completed) {
            complete_button.addEventListener("click",() => {

                updateCompleted(task.id, true) // update database
                psuedoUpdateCompletedTasks() // update statistics

                row.classList.remove("incomplete"); // removes strikethrough
                row.classList.add("complete"); // adds strikethrough

                table.removeChild(row)

                // remove completed button
                buttonContainer.removeChild(complete_button);

                // indicates if a completed task was found
                let found = false;
                // loop through the table to find the first element that is completed for insertion
                for (const child of table.children) {
                    if (child.classList[1] === "complete") {
                        table.insertBefore(row, child);
                        found = true;
                        break;
                    }
                }

                // if didn't find any, add to the end
                if (!found) {
                    table.appendChild(row);
                }

            });

            buttonContainer.appendChild(complete_button);
        }

        delete_button.addEventListener("click", () => {
            deleteTask(task.id)
            table.removeChild(row);

            // decrement complete statistic ONLY if completed
            if (row.className === "complete") {
                psuedoUpdateDelete();
            }
        });

        buttonContainer.appendChild(delete_button);
        row.appendChild(buttonContainer);

        if (task.completed) {
            table.appendChild(row);
        } else {
            table.prepend(row);
        }
    });

    // No task message
    if (taskList.length === 0) {
        table.innerHTML = "No tasks. Add a task for the day!"
    }
};

/**
 * Creates the complete and delete buttons 
 * 
 * @returns [complete_button, delete_button] - buttons to add to task row
 */
const addButtons = () => {
    const complete_button = document.createElement("button");
    const delete_button = document.createElement("button");

    const complete_img = document.createElement("img");
    complete_img.src = "displayTasks/Check.png";
    complete_img.alt = "Complete";

    const delete_img = document.createElement("img");
    delete_img.src = "displayTasks/TrashSimple.png";
    delete_img.alt = "Delete";

    complete_img.classList.add("row-image");
    delete_img.classList.add("row-image");

    complete_button.classList.add("row-button");
    delete_button.classList.add("row-button");

    complete_button.appendChild(complete_img);
    delete_button.appendChild(delete_img);

    return [complete_button, delete_button];
}

/**
 * Adds 1 to the number of completed tasks for the statistics element
 */
const psuedoUpdateCompletedTasks = () => {
    const completeStats = document.querySelector("completed-statistics");
    const numTasks = completeStats.shadowRoot.getElementById("num-tasks");

    numTasks.innerText = Number(numTasks.innerText) + 1;
}

/**
 * Decrements 1 from number of completed tasks for the statistics element
 */
const psuedoUpdateDelete = () => {
    const completeStats = document.querySelector("completed-statistics");
    const numTasks = completeStats.shadowRoot.getElementById("num-tasks");

    numTasks.innerText = Number(numTasks.innerText) - 1;
}

/**
 * Changes the task list header to have the current selected date
 * 
 * @param {Date} date 
 */
const addDateToHeader = (date) => {
    const header = document.querySelector("div[id='task-container'] h1");
    const dateOptions = {
        month: "numeric",
        day: "numeric",
        year: "numeric"
    }
    header.innerText = date.toLocaleDateString(undefined, dateOptions) + " Tasks";
}

window.addEventListener("DOMContentLoaded", () => {
    // class to allow observing of global selected date
    const taskObserver = new class {
        update(date) {
            try {
                fetchJson(date.toISOString().slice(0, 10));
                addDateToHeader(date);
            } catch (error) {
                console.error(error);
            }
        }
    }();

    taskObserver.update(new Date()); // initial load date

    const sidebar = document.querySelector("side-calendar");
    sidebar.addObserver(taskObserver);
})</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SideCalendar.html">SideCalendar</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addButtons">addButtons</a></li><li><a href="global.html#addDateToHeader">addDateToHeader</a></li><li><a href="global.html#addStreaks">addStreaks</a></li><li><a href="global.html#deleteTask">deleteTask</a></li><li><a href="global.html#fetchJson">fetchJson</a></li><li><a href="global.html#fetchNumberCompleted">fetchNumberCompleted</a></li><li><a href="global.html#fetchTasks">fetchTasks</a></li><li><a href="global.html#fetchTasksDue">fetchTasksDue</a></li><li><a href="global.html#populateTable">populateTable</a></li><li><a href="global.html#psuedoUpdateCompletedTasks">psuedoUpdateCompletedTasks</a></li><li><a href="global.html#psuedoUpdateDelete">psuedoUpdateDelete</a></li><li><a href="global.html#server">server</a></li><li><a href="global.html#serveStaticFile">serveStaticFile</a></li><li><a href="global.html#updateCompleted">updateCompleted</a></li><li><a href="global.html#updateTaskCompletion">updateTaskCompletion</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Jun 07 2024 06:31:45 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
